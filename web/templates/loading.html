<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Genesis Exam Maker — Loading</title>
  <link rel="stylesheet" href="../css/style.css">
  <style>
    /* überschreibe nur was nötig für den Lade-Screen */
    html, body { height: 100%; margin: 0; }
    body {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: #fbfbfd; /* sehr hell */
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      color: #222;
    }
    .loader-card {
      width: 760px;
      max-width: calc(100% - 48px);
      background: #fff;
      padding: 36px 28px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(15,20,30,0.06);
      text-align: center;
    }
    .logo {
      width: 180px;
      height: auto;
      margin: 0 auto 18px;
    }
    h1 { margin: 0 0 6px; font-size: 28px; }
    .sub { margin-bottom: 20px; color: #555; }
    .progress-wrap {
      position: relative;
      height: 12px;
      background: #efeff5;
      border-radius: 8px;
      overflow: hidden;
      margin-top: 28px;
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg,#007bff,#00a6ff);
      transition: width 400ms ease;
    }
    .progress-msg {
      margin-top: 12px;
      font-size: 13px;
      color: #666;
    }
    .hidden { display:none; }
  </style>
</head>
<body>
  <div class="loader-card" role="main" aria-live="polite">
    <img class="logo" src="../../assets/genesis-exam-maker.png" alt="Genesis Exam Maker Logo">
    <h1>Genesis Exam Maker</h1>
    <div class="sub">Die App startet. Bitte einen Moment bleiben — wir bereiten alles vor.</div>

    <div class="progress-wrap" aria-hidden="false">
      <div id="progressBar" class="progress-bar"></div>
    </div>
    <div id="progressMsg" class="progress-msg">Initialisiere...</div>
  </div>

  <script>
    // Exponierte JS-Funktion, die Python durch window.evaluate_js(...) aufruft:
    window.setProgress = function(percent, message) {
      const bar = document.getElementById('progressBar');
      const msg = document.getElementById('progressMsg');
      percent = Math.max(0, Math.min(100, Math.round(percent)));
      bar.style.width = percent + '%';
      msg.textContent = message || '';
    };

    // Sanfter Fade-Out und Navigation — wird vom Python-Code aufgerufen,
    // falls du lieber JS die Navigation machen lassen willst.
    window.finishAndLoad = function(targetUrl) {
      document.querySelector('.loader-card').style.transition = 'opacity 400ms ease';
      document.querySelector('.loader-card').style.opacity = '0';
      setTimeout(function() {
        // Lade die richtige App-Seite in dasselbe Fenster
        window.location.href = targetUrl;
      }, 420);
    };

    // kleine nützliche Helper in GUI: falls Python die Verbindung verliert
    window.onerror = function(msg, src, lineno, colno, err) {
      const msgEl = document.getElementById('progressMsg');
      msgEl.textContent = 'UI-Fehler: ' + msg;
      return false;
    };
  </script>
</body>
</html>
